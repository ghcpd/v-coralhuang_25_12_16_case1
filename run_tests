#!/usr/bin/env python3
"""
Simple cross-platform test runner: creates virtualenv, installs requirements, and runs pytest.
Run with: python run_tests
"""
import os
import subprocess
import sys

ROOT = os.path.dirname(os.path.abspath(__file__))
VENV_DIR = os.path.join(ROOT, ".venv_test")
PY = sys.executable

def run(cmd, check=True):
    print("$", " ".join(cmd))
    subprocess.check_call(cmd, cwd=ROOT)

def main():
    # create venv
    if not os.path.exists(VENV_DIR):
        run([PY, "-m", "venv", VENV_DIR])
    # pip path
    if os.name == 'nt':
        pip = os.path.join(VENV_DIR, "Scripts", "pip.exe")
        py = os.path.join(VENV_DIR, "Scripts", "python.exe")
    else:
        pip = os.path.join(VENV_DIR, "bin", "pip")
        py = os.path.join(VENV_DIR, "bin", "python")

    run([pip, "install", "-r", "requirements.txt"])
    # run pytest
    run([py, "-m", "pytest", "-q"]) 

if __name__ == '__main__':
    main()
